# Amazon S3 - Guia de Estudo AWS Developer

## üìã √çndice

- [Conceitos Fundamentais](#conceitos-fundamentais)
- [Pontos Cr√≠ticos para o Exame](#pontos-cr√≠ticos-para-o-exame)
- [Classes de Armazenamento](#classes-de-armazenamento)
- [Versionamento e Lifecycle](#versionamento-e-lifecycle)
- [Seguran√ßa e Controle de Acesso](#seguran√ßa-e-controle-de-acesso)
- [Performance e Otimiza√ß√£o](#performance-e-otimiza√ß√£o)
- [Encripta√ß√£o](#encripta√ß√£o)
- [S3 Pricing](#s3-pricing)
- [Cross Region Replication (CRR)](#cross-region-replication-crr)
- [Perguntas e Respostas](#perguntas-e-respostas)
- [Refer√™ncias](#refer√™ncias)

---

## Conceitos Fundamentais

### O que √© S3?
**Simple Storage Service** √© o servi√ßo de armazenamento de objetos da AWS que oferece escalabilidade, disponibilidade, seguran√ßa e performance. √â um dos servi√ßos mais importantes para o exame AWS Developer.

### Caracter√≠sticas Essenciais para o Exame:
- **Escopo Regional**: O servi√ßo S3 √© regional, mas nomes de buckets s√£o √∫nicos globalmente
- **Limite de Objeto**: M√°ximo de 5TB por objeto
- **Capacidade Ilimitada**: N√£o h√° limite para a capacidade total do bucket
- **Consist√™ncia**: Read-after-write consistency para novos objetos e eventual consistency para sobrescritas/dele√ß√µes
- **Durabilidade**: 99.999999999% (11 noves)
- **Disponibilidade**: 99.99% para S3 Standard

### Estrutura de URL:
```
https://bucket-name.s3.region.amazonaws.com/key-name
```

---

## Pontos Cr√≠ticos para o Exame

### 1. Pol√≠ticas de Acesso (IAM vs Bucket Policy vs ACL)
- **IAM Policies**: Aplicadas a usu√°rios/grupos/roles
- **Bucket Policies**: Aplicadas ao bucket (resource-based)
- **ACLs**: Controle granular por objeto (legacy, evitar usar)

### 2. Prefixos e Performance
- Use prefixos aleat√≥rios para distribuir carga
- Evite padr√µes sequenciais (timestamps, IDs incrementais)
- S3 pode escalar para 3.500 PUT/COPY/POST/DELETE requests por segundo por prefixo

### 3. Multipart Upload
- **Obrigat√≥rio** para objetos > 5GB
- **Recomendado** para objetos > 100MB
- Permite uploads paralelos e recupera√ß√£o de falhas

---

## Classes de Armazenamento

### S3 Standard
- **Uso**: Dados acessados frequentemente
- **Durabilidade**: 99.999999999% (11 noves)
- **Disponibilidade**: 99.99%
- **AZs**: M√≠nimo 3 zonas de disponibilidade

### S3 Intelligent-Tiering
- **Uso**: Padr√£o de acesso desconhecido ou vari√°vel
- **Taxa**: Pequena taxa mensal de monitoramento
- **Automa√ß√£o**: Move objetos entre tiers automaticamente

### S3 Standard-IA (Infrequent Access)
- **Uso**: Dados acessados ocasionalmente
- **Retrieval**: Taxa por recupera√ß√£o
- **Minimum Storage Duration**: 30 dias
- **AZs**: M√≠nimo 3 zonas de disponibilidade

### S3 One Zone-IA
- **Uso**: Dados n√£o cr√≠ticos, acessados ocasionalmente
- **AZs**: Apenas 1 zona de disponibilidade
- **Custo**: 20% mais barato que Standard-IA
- **Minimum Storage Duration**: 30 dias

### S3 Glacier Instant Retrieval
- **Uso**: Arquivos raramente acessados, acesso imediato necess√°rio
- **Retrieval**: Milissegundos
- **Minimum Storage Duration**: 90 dias

### S3 Glacier Flexible Retrieval
- **Uso**: Backup, arquivos acessados 1-2 vezes por ano
- **Retrieval**: 1 minuto a 12 horas
- **Minimum Storage Duration**: 90 dias
- **Op√ß√µes**: Expedited (1-5 min), Standard (3-5 hours), Bulk (5-12 hours)

### S3 Glacier Deep Archive
- **Uso**: Reten√ß√£o de longo prazo (7-10 anos)
- **Retrieval**: 12-48 horas
- **Minimum Storage Duration**: 180 dias
- **Custo**: Mais barato de todas as classes

---

## Versionamento e Lifecycle

### Versionamento
- **Estado**: Habilitado, Suspenso ou Nunca Habilitado
- **Delete Markers**: Criados quando objeto √© deletado com versionamento ativo
- **Restaura√ß√£o**: Poss√≠vel deletar vers√µes espec√≠ficas
- **MFA Delete**: Prote√ß√£o adicional para dele√ß√£o permanente

### Lifecycle Policies
- **Transi√ß√£o**: Move objetos entre classes automaticamente
- **Expira√ß√£o**: Deleta objetos automaticamente
- **Vers√µes**: Pode ser aplicado a vers√µes atuais e n√£o-atuais
- **Multipart Uploads**: Pode limpar uploads incompletos

---

## Seguran√ßa e Controle de Acesso

### Bucket Policies vs IAM Policies
**Use Bucket Policy quando:**
- Controle centralizado no bucket
- Acesso cross-account
- Condi√ß√µes baseadas em IP, VPC, etc.

**Use IAM Policy quando:**
- Controle baseado em usu√°rio/role
- M√∫ltiplos buckets para mesmo usu√°rio

### Condi√ß√µes Importantes
```json
{
  "StringEquals": {
    "s3:x-amz-server-side-encryption": "AES256"
  },
  "IpAddress": {
    "aws:SourceIp": "203.0.113.0/24"
  },
  "StringLike": {
    "s3:prefix": "home/${aws:username}/*"
  }
}
```

### Pre-signed URLs
- **Uso**: Acesso tempor√°rio sem credenciais AWS
- **Expira√ß√£o**: Configur√°vel (padr√£o 1 hora)
- **Permiss√µes**: Limitadas √†s permiss√µes do criador da URL

---

## Performance e Otimiza√ß√£o

### Request Rate Performance
- **GET/HEAD**: 5.500 requests por segundo por prefixo
- **PUT/COPY/POST/DELETE**: 3.500 requests por segundo por prefixo

### Transfer Acceleration
- **Uso**: CloudFront edge locations para uploads
- **Benef√≠cio**: Reduz lat√™ncia para uploads de longa dist√¢ncia
- **URL**: `bucket-name.s3-accelerate.amazonaws.com`

### Multipart Upload
- **Partes**: 1-10.000 partes
- **Tamanho**: 5MB-5GB por parte (exceto √∫ltima)
- **Paralelismo**: Upload simult√¢neo de partes

---

## Encripta√ß√£o

### Server-Side Encryption
1. **SSE-S3**: AWS managed keys (AES-256)
2. **SSE-KMS**: AWS KMS managed keys
3. **SSE-C**: Customer provided keys

### Client-Side Encryption
- **CSE-KMS**: Client encrypts usando AWS KMS
- **CSE-C**: Client encrypts usando pr√≥prias keys

### Headers de Encripta√ß√£o
```
x-amz-server-side-encryption: AES256
x-amz-server-side-encryption: aws:kms
x-amz-server-side-encryption-aws-kms-key-id: key-id
```

---

## S3 Pricing

### Componentes de Custo
1. **Storage**: Por GB armazenado
2. **Requests**: GET, PUT, COPY, POST, LIST requests
3. **Data Transfer**: OUT da AWS (IN √© gratuito)
4. **Management Features**: Inventory, Analytics, Object Tagging

### Considera√ß√µes
- **Free Tier**: 5GB S3 Standard, 20.000 GET, 2.000 PUT requests
- **Regional Pricing**: Varia por regi√£o
- **Storage Classes**: Pre√ßos diferentes por classe

---

## Cross Region Replication (CRR)

### Requisitos
- **Versionamento**: Deve estar habilitado em ambos buckets
- **Permiss√µes**: IAM role com permiss√µes adequadas
- **Buckets**: Devem estar em regi√µes diferentes

### Caracter√≠sticas
- **Tempo**: Replica√ß√£o ass√≠ncrona (geralmente minutos)
- **Objetos Existentes**: N√£o s√£o replicados automaticamente
- **Delete Markers**: Podem ser replicados (configur√°vel)
- **Encrypted Objects**: Suportado com SSE-S3, SSE-KMS, SSE-C

### Comando para Objetos Existentes
```bash
aws s3 cp --recursive s3://source-bucket s3://destination-bucket
```

---

## Perguntas e Respostas

### Q1: Qual a diferen√ßa entre S3 Standard-IA e S3 One Zone-IA?
**R:** S3 Standard-IA armazena dados em m√∫ltiplas AZs (m√≠nimo 3), oferecendo maior durabilidade e disponibilidade. S3 One Zone-IA armazena em apenas uma AZ, sendo 20% mais barato, mas com menor resili√™ncia - se a AZ falhar, os dados s√£o perdidos.

### Q2: Quando usar Multipart Upload?
**R:** √â obrigat√≥rio para objetos maiores que 5GB e recomendado para objetos maiores que 100MB. Permite uploads paralelos, melhor performance e recupera√ß√£o de falhas sem reiniciar todo o upload.

### Q3: Como funciona o S3 Intelligent-Tiering?
**R:** Monitora padr√µes de acesso e move automaticamente objetos entre tiers de acesso frequente e infrequente. Cobra uma pequena taxa mensal de monitoramento, mas pode economizar custos significativos para dados com padr√µes de acesso imprevis√≠veis.

### Q4: Qual a diferen√ßa entre Bucket Policy e IAM Policy?
**R:** Bucket Policy √© anexada ao bucket e controla quem pode acess√°-lo (resource-based). IAM Policy √© anexada a usu√°rios/grupos/roles e controla o que podem fazer (identity-based). Use Bucket Policy para acesso cross-account e controle centralizado no bucket.

### Q5: O que acontece quando voc√™ deleta um objeto em um bucket versionado?
**R:** Um "delete marker" √© criado, mas as vers√µes anteriores permanecem. Para deletar permanentemente, voc√™ deve deletar todas as vers√µes e o delete marker.

### Q6: Como garantir que todos os objetos sejam criptografados?
**R:** Use uma Bucket Policy que negue uploads sem o header de criptografia apropriado:
```json
{
  "Effect": "Deny",
  "Principal": "*",
  "Action": "s3:PutObject",
  "Resource": "arn:aws:s3:::bucket-name/*",
  "Condition": {
    "StringNotEquals": {
      "s3:x-amz-server-side-encryption": "AES256"
    }
  }
}
```

### Q7: Qual o tempo m√≠nimo de armazenamento para cada classe?
**R:** 
- S3 Standard, Intelligent-Tiering: Nenhum
- S3 Standard-IA, One Zone-IA: 30 dias
- S3 Glacier Instant/Flexible Retrieval: 90 dias
- S3 Glacier Deep Archive: 180 dias

### Q8: Como otimizar performance para muitos requests simult√¢neos?
**R:** Use prefixos aleat√≥rios para distribuir a carga. Evite padr√µes sequenciais como timestamps. S3 pode escalar automaticamente para suportar altas taxas de request por prefixo.

### Q9: Diferen√ßa entre SSE-S3, SSE-KMS e SSE-C?
**R:** 
- **SSE-S3**: AWS gerencia as chaves, criptografia AES-256
- **SSE-KMS**: Usa AWS KMS, permite rota√ß√£o de chaves e auditoria
- **SSE-C**: Cliente fornece as chaves, AWS apenas criptografa/descriptografa

### Q10: Como funciona Transfer Acceleration?
**R:** Usa CloudFront edge locations para upload. Cliente faz upload para edge location mais pr√≥xima, que ent√£o transfere para o bucket via rede otimizada da AWS. √ötil para uploads de longa dist√¢ncia.

### Q11: O que √© eventual consistency no S3?
**R:** Para sobrescritas (PUT de objeto existente) e dele√ß√µes (DELETE), pode haver um breve per√≠odo onde diferentes requests podem retornar dados antigos ou novos. Para novos objetos (PUT de novo objeto), h√° read-after-write consistency.

### Q12: Como configurar Cross Region Replication?
**R:** 
1. Habilitar versionamento em ambos buckets
2. Criar IAM role com permiss√µes adequadas
3. Configurar regra de replica√ß√£o no bucket origem
4. Para objetos existentes, usar comando aws s3 cp --recursive

### Q13: Quando usar Pre-signed URLs?
**R:** Para dar acesso tempor√°rio a objetos S3 sem expor credenciais AWS. Comum em aplica√ß√µes web para permitir upload/download direto pelos usu√°rios. URLs expiram automaticamente ap√≥s tempo configurado.

### Q14: Como funciona S3 Lifecycle?
**R:** Automatiza transi√ß√µes entre classes de armazenamento e expira√ß√£o de objetos. Pode ser aplicado a objetos atuais, vers√µes n√£o-atuais, e multipart uploads incompletos. Baseado em idade do objeto ou tags.

### Q15: Diferen√ßa entre durabilidade e disponibilidade?
**R:** 
- **Durabilidade**: Probabilidade de n√£o perder dados (99.999999999% = perda de 1 objeto em 10 bilh√µes por ano)
- **Disponibilidade**: Tempo que o servi√ßo est√° acess√≠vel (99.99% = ~53 minutos de downtime por ano)

---

## Refer√™ncias

- [Documenta√ß√£o Oficial AWS S3](https://docs.aws.amazon.com/s3/)
- [AWS S3 Storage Classes](https://aws.amazon.com/s3/storage-classes/)
- [AWS S3 Security Best Practices](https://docs.aws.amazon.com/s3/latest/userguide/security-best-practices.html)
- [AWS S3 Performance Guidelines](https://docs.aws.amazon.com/s3/latest/userguide/optimizing-performance.html)
- [AWS S3 FAQ](https://aws.amazon.com/s3/faqs/)

---

## üí° Dicas para o Exame

1. **Memorize os tempos m√≠nimos de armazenamento** de cada classe
2. **Entenda quando usar cada tipo de criptografia** (SSE-S3 vs SSE-KMS vs SSE-C)
3. **Saiba a diferen√ßa entre Bucket Policy e IAM Policy** e quando usar cada uma
4. **Compreenda Multipart Upload** - quando √© obrigat√≥rio vs recomendado
5. **Lembre-se dos limites**: 5TB por objeto, 3.500 PUT requests por prefixo
6. **Entenda Cross Region Replication** - requisitos e limita√ß√µes
7. **Saiba sobre Transfer Acceleration** e quando usar
8. **Compreenda versionamento** e delete markers
9. **Entenda as diferen√ßas entre classes de armazenamento** e casos de uso
10. **Pratique cen√°rios de troubleshooting** com pol√≠ticas de acesso
